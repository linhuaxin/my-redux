<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>my-redux</title>
</head>
<body>
  <button id="increment">+1</button>
  <span id="counter">0</span>
  <button id="decrement">-1</button>

  <script src="./index.js"></script>
  <script>
    const reducer = function (state, action) {
      switch (action.type) {
        case 'increment':
          return {
            count: state.count + 1
          }
        case 'decrement':
          return {
            count: state.count - 1
          }
        default:
          return state;
      }
    };

    const enhancer = function (createStore, reducer, state) {
      let store = createStore(reducer, state);
      let dispatch = store.dispatch;

      store.dispatch = function(action) {
        if (typeof action === 'function') {
          action(dispatch);
          return;
        }
        dispatch(action);
      };

      return {
        ...store,
        dispatch: store.dispatch
      };
    }

    const store = createStore(reducer, { count: 0 }, enhancer);

    store.subscribe(() => {
      // console.log(store.getState());
      document.getElementById('counter').innerText = store.getState().count;
    });

    document.getElementById('increment').onclick = function () {
      // store.dispatch({ type: 'increment' });
      store.dispatch(dispatch => {
        setTimeout(() => {
          dispatch({ type: 'increment' });
        }, 2000);
      });
    };

    document.getElementById('decrement').onclick = function () {
      store.dispatch({ type: 'decrement' });
    };
  </script>
</body>
</html>
